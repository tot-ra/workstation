# TO INSTALL plugins
# F1 + r
# F1 + I
unbind r
unbind F3

#set-environment -g PATH "/usr/local/bin:/bin:/usr/bin"

bind r source-file ~/.tmux.conf
set -g prefix F1 
set -g mouse on

# place status on top
set-option -g status-position top

# Increase status bar height (default is 1)
set-option -g status-format[1] ''
set-option -g status-format[2] ''
set -g status 3

# limit max history
set-option -g history-limit 30000

# update window name to match directory
set-option -g status-interval 5
set-option -g automatic-rename on
set-option -g automatic-rename-format '#{b:pane_current_path}'

# open new window in same directory
bind  +  new-window      -c "#{pane_current_path}"
bind  '|'  split-window -h -c "#{pane_current_path}"
bind '-' split-window -v -c "#{pane_current_path}"


#set -g pane-active-border-style "bg=default,fg=colour166"
#set -g pane-border-style "bg=default,fg=colour245"
#set -g pane-border-lines "double"

# Navigation between panes
# https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
        | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?|fzf)(diff)?$'"
        bind-key -n 'C-Left' if-shell "$is_vim" 'send-keys C-Left'  'select-pane -L'
        bind-key -n 'C-Down' if-shell "$is_vim" 'send-keys C-Down'  'select-pane -D'
        bind-key -n 'C-Up' if-shell "$is_vim" 'send-keys C-Up'  'select-pane -U'
        bind-key -n 'C-Right' if-shell "$is_vim" 'send-keys C-Right'  'select-pane -R'

        bind-key -T copy-mode-vi 'C-Left' select-pane -L
        bind-key -T copy-mode-vi 'C-Down' select-pane -D
        bind-key -T copy-mode-vi 'C-Up' select-pane -U
        bind-key -T copy-mode-vi 'C-Right' select-pane -R

bind-key -n C-S-Left previous-window
bind-key -n C-S-Right next-window
bind-key * send-keys -R \; clear-history

set -g @plugin 'alexwforsythe/tmux-which-key'


# set -g @plugin 'omerxx/tmux-sessionx'
# set -g @sessionx-bind 't'
# set -g @sessionx-tree-mode 'on'
# set -g @sessionx-preview-location 'right'
# set -g @sessionx-preview-ratio '50%'
# set -g @sessionx-window-height '40%'
# set -g @sessionx-window-width '50%'
#


# Allow copy-pasting from tmux
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @yank_selection_mouse 'clipboard'

# Enable OSC 52 for clipboard integration over SSH
set -g set-clipboard on


# Persist sessions in case of reboot
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# tmux-resurrect settings
set -g @resurrect-dir '~/.tmux/resurrect'
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-nvim 'session'

# tmux-continuum settings
# Enable automatic restore of tmux sessions (only if session file exists)
set -g @continuum-restore 'on'
# Auto-save interval in minutes (default: 15)
set -g @continuum-save-interval '15'


set -g @plugin '2kabhishek/tmux2k'
set -g @tmux2k-theme 'default'
# set the left and right plugin sections
set -g @tmux2k-left-plugins ""
set -g @tmux2k-right-plugins "battery time"

set -g @tmux2k-fixed-location "Tallinn"

# to set window list alignment (centre by default)
set -g @tmux2k-window-list-alignment 'left'

set -g @tmux2k-icons-only false
set -g @tmux2k-show-powerline true
#set -g @tmux2k-left-sep î‚¶  # alternate right status bar sep
set -g @tmux2k-right-sep ' '

# to customize plugin colors
# set -g @tmux2k-[plugin-name]-colors "[background] [foreground]"
set -g @tmux2k-window-colors "bg_main blue" # set cpu plugin bg to red, fg to black
set -g @tmux2k-battery-colors "bg_main white" # set cpu plugin bg to red, fg to black
set -g @tmux2k-time-colors "bg_main white" # set cpu plugin bg to red, fg to black

# to enable compact window list size
set -g @tmux2k-compact-windows false

# change refresh rate
set -g @tmux2k-refresh-rate 5

# weather scale
set -g @tmux2k-show-fahrenheit false

# 24 hour time
set -g @tmux2k-military-time true

# network interface to watch
set -g @tmux2k-network-name "wlo1"

# Plugin manager
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
run '~/.tmux/plugins/tpm/tpm'


# Use vi keybindings in copy mode
setw -g mode-keys vi

# Enable mouse support for copy mode
set -g @yank_with_mouse on

# Override tmux-yank to use tmux's built-in clipboard (OSC 52) instead of xclip
# This works over SSH without X11 forwarding
set -g @custom_copy_command 'tmux load-buffer -w -'

# Manual bindings for clipboard that work with OSC 52 over SSH
# These override tmux-yank's default bindings
# Use tmux's built-in copy command which respects set-clipboard

# Keyboard bindings
bind-key -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind-key -T copy-mode-vi Y send-keys -X copy-line \; send-keys -X copy-selection-and-cancel
bind-key -T copy-mode y send-keys -X copy-selection-and-cancel
bind-key -T copy-mode Y send-keys -X copy-line \; send-keys -X copy-selection-and-cancel

# Mouse bindings - copy on drag release
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-selection-and-cancel
bind-key -T copy-mode MouseDragEnd1Pane send-keys -X copy-selection-and-cancel

# Double/Triple click bindings
bind-key -T copy-mode-vi DoubleClick1Pane select-pane \; send-keys -X select-word \; send-keys -X copy-selection-and-cancel
bind-key -T copy-mode-vi TripleClick1Pane select-pane \; send-keys -X select-line \; send-keys -X copy-selection-and-cancel
bind-key -T copy-mode DoubleClick1Pane select-pane \; send-keys -X select-word \; send-keys -X copy-selection-and-cancel
bind-key -T copy-mode TripleClick1Pane select-pane \; send-keys -X select-line \; send-keys -X copy-selection-and-cancel

# Root level mouse bindings (when not in copy mode)
bind-key -T root MouseDrag1Pane if-shell -F "#{||:#{pane_in_mode},#{mouse_any_flag}}" "send -M" "copy-mode -M"
bind-key -T root MouseDragEnd1Pane send-keys -X copy-selection-and-cancel
bind-key -T root DoubleClick1Pane select-pane -t = \; copy-mode -H \; send-keys -X select-word \; send-keys -X copy-selection-and-cancel
bind-key -T root TripleClick1Pane select-pane -t = \; copy-mode -H \; send-keys -X select-line \; send-keys -X copy-selection-and-cancel


# Configuration to fix 'missing or unsuitable terminal: xterm-ghostty' error (Added by opencode)
set -g default-terminal "tmux-256color"
# Override for ghostty to enable true color (Tc) and italics (sitm/ritm) capabilities,
# as the terminfo may be missing on the server.
set -as terminal-overrides ',xterm-ghostty:Tc:sitm=\E[3m:ritm=\E[23m'
